<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overview of the vista package • vista</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Overview of the vista package">
<meta property="og:description" content="vista">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vista</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a01_vista.html">Overview of the vista package</a>
    </li>
    <li>
      <a href="../articles/a02_spatial_residuals.html">Plotting spatial residuals</a>
    </li>
    <li>
      <a href="../articles/a03_temporal_residuals.html">Plotting temporal residuals</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ericward-noaa/vista/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Overview of the vista package</h1>
            
            <h4 data-toc-skip class="date">2022-06-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ericward-noaa/vista/blob/HEAD/vignettes/a01_vista.Rmd" class="external-link"><code>vignettes/a01_vista.Rmd</code></a></small>
      <div class="hidden name"><code>a01_vista.Rmd</code></div>

    </div>

    
    
<p>Here we will use the vista package visualize output from
spatiotemporal models</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ericward-noaa.github.io/vista/" class="external-link">vista</a></span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>Each of the functions in the <code>vista</code> package takes a
generic data frame as an argument. As some examples, we can fit models
to the <code>pcod</code> example dataset from Pacific cod in the
<code>sdmTMB</code> package, collected by Fisheries and Oceans
Canada.</p>
<div class="section level3">
<h3 id="sdmtmb">1. sdmTMB<a class="anchor" aria-label="anchor" href="#sdmtmb"></a>
</h3>
<p>sdmTMB is a package for fitting generalized linear mixed models
(GLMMs) with spatial and spatiotemporal Gaussian random fields. The
package can be installed here,</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"pbs-assess/sdmTMB"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pbs-assess.github.io/sdmTMB/index.html" class="external-link">sdmTMB</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">)</span></code></pre></div>
<p>We fit a fairly simple spatiotemporal model, using an example from
the package. Don’t worry about all the arguments – the density of
Pacific cod is modeled as a function of fixed effects (years) and
spatiotemporal random fields (essentially different spatial maps in each
year). The response is modeled with a Tweedie distribution.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sdmTMB/man/make_mesh.html" class="external-link">make_mesh</a></span><span class="op">(</span><span class="va">pcod</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sdmTMB/man/sdmTMB.html" class="external-link">sdmTMB</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">pcod</span>,
  formula <span class="op">=</span> <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,
  time <span class="op">=</span> <span class="st">"year"</span>,
  mesh <span class="op">=</span> <span class="va">mesh</span>,
  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sdmTMB/man/families.html" class="external-link">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,
  spatial <span class="op">=</span> <span class="st">"off"</span>
<span class="op">)</span></code></pre></div>
<p>Next, we can calculate the residual and predicted values from the
fitted model</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pcod</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">$</span><span class="va">est</span>
<span class="va">pcod</span><span class="op">$</span><span class="va">resid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generalized-additive-models-gams-in-mgcv">2. generalized additive models (GAMs) in mgcv<a class="anchor" aria-label="anchor" href="#generalized-additive-models-gams-in-mgcv"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">pcod</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/Tweedie.html" class="external-link">tw</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Again, calculate the residual and predicted values</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pcod</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>
<span class="va">pcod</span><span class="op">$</span><span class="va">resid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="random-forest-models">3. random forest models<a class="anchor" aria-label="anchor" href="#random-forest-models"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span><span class="op">)</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span><span class="op">(</span><span class="va">density</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="va">X</span> <span class="op">+</span> <span class="va">Y</span> <span class="op">+</span> <span class="va">X</span><span class="op">:</span><span class="va">Y</span>, data <span class="op">=</span> <span class="va">pcod</span><span class="op">)</span></code></pre></div>
<p>Objects of class <code>randomForest</code> can be used with the
predict function, but because these are non-parametric methods, some of
the plots in the <code>vista</code> package (specifically those focused
on residuals) won’t work.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pcod</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="types-of-plots">Types of plots<a class="anchor" aria-label="anchor" href="#types-of-plots"></a>
</h2>
<p>We can use the <code>vista</code> package to generate diagnostic
plots. Each plot can be run individually. Some example functions are
below (illustrating how to use them with our pcod example above):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Look at all predictions over space, faceted by time (or not)</span>
<span class="fu"><a href="../reference/pred_space.html">pred_space</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">pcod</span>, time <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>
<span class="co"># Look at all predictions time</span>
<span class="fu"><a href="../reference/pred_time.html">pred_time</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">pcod</span>, time <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>
<span class="co"># Look at residuals over space, faceted by time (or not)</span>
<span class="fu"><a href="../reference/resid_space.html">resid_space</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">pcod</span>, time <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>
<span class="co"># Look at all residuals over time</span>
<span class="fu"><a href="../reference/resid_time.html">resid_time</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">pcod</span>, time <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>
<span class="co"># Look at variation in residuals through time</span>
<span class="fu"><a href="../reference/sd_resid_time.html">sd_resid_time</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">pcod</span>, time <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>
<span class="co"># Look at variation in residuals across space, faceted by time (or not)</span>
<span class="fu"><a href="../reference/sd_resid_space.html">sd_resid_space</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">pcod</span>, time <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>
<span class="co"># Look at qq plots, faceted by time (or not)</span>
<span class="fu"><a href="../reference/qq.html">qq</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">pcod</span>, time <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>
<span class="co"># Look at qq plots over space, faceted by time (or not)</span>
<span class="fu"><a href="../reference/qq_space.html">qq_space</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">pcod</span>, time <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>
<span class="co"># Look at predictions vs residuals, faceted by time (or not)</span>
<span class="fu"><a href="../reference/pred_resid.html">pred_resid</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">pcod</span>, time <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>
<span class="co"># Look at time series of Moran statistics (e.g. residuals, predicted values)</span>
<span class="fu"><a href="../reference/moran_ts.html">moran_ts</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">pcod</span>, time <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>As an alternative to generating plots individually with specific
functions, we can call the wrapper function to run all plots. This is a
lot more convenient, and returns a list of ggplot() objects.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diagnostic_plots.html">diagnostic_plots</a></span><span class="op">(</span><span class="va">pcod</span>, time <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></code></pre></div>
<p>We can inspect the plots individually, e.g. </p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">plots</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "pred_space"         "pred_space_bytime"  "pred_time"         </span>
<span class="co">##  [4] "resid_space"        "resid_space_bytime" "resid_time"        </span>
<span class="co">##  [7] "sd_resid_time"      "sd_resid_space"     "qq"                </span>
<span class="co">## [10] "qq_time"            "qq_space"           "pred_resid"        </span>
<span class="co">## [13] "moran_pred"         "moran_resid"        "scale_loc"         </span>
<span class="co">## [16] "scale_loc_time"</span></code></pre>
<p>Or look at them individually. For example we can look at the
residuals spatially, and across time slices with</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plots</span><span class="op">$</span><span class="va">resid_space_bytime</span></code></pre></div>
<p><img src="a01_vista_files/figure-html/unnamed-chunk-13-1.png" width="528"></p>
<p>This may not be informative (because residuals are often on different
scales). Instead we can look at the randomized quantile residuals,</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plots</span><span class="op">$</span><span class="va">qq_space</span></code></pre></div>
<p><img src="a01_vista_files/figure-html/unnamed-chunk-14-1.png" width="528"></p>
<p>Some plots are specific to particular models. For example, looking at
the mean residuals over space, all values are 0 because each row of the
dataframe has a unique (X,Y) coordinate – as opposed to repeat sampling
at fixed stations.</p>
<p>The standard deviation of residuals over time seems to maybe suggest
higher variability earlier in the time series, but not a trend in the
variation over time</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plots</span><span class="op">$</span><span class="va">sd_resid_time</span></code></pre></div>
<p><img src="a01_vista_files/figure-html/unnamed-chunk-15-1.png" width="528"></p>
<p>Additional statistics (such as the Moran statistic) can be used to
diagnose lingering spatial autocorrelation. These plots can be made on
the predictions (where we expect there to be spatial
autocorrelation)</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plots</span><span class="op">$</span><span class="va">moran_pred</span></code></pre></div>
<p><img src="a01_vista_files/figure-html/unnamed-chunk-16-1.png" width="528"></p>
<p>or on the residuals, where we hope there is little residual
autocorrelation (because our spatial model is explaining away most of
it).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plots</span><span class="op">$</span><span class="va">moran_resid</span></code></pre></div>
<p><img src="a01_vista_files/figure-html/unnamed-chunk-17-1.png" width="528"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Eric J. Ward, Sean C. Anderson, Lewis A.K. Barnett,
Kelli F. Johnson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
